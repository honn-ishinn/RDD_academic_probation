---
title: "Untitled"
author: "Hong Shi"
date: "4/13/2021"
output: pdf_document
---
```{r}
library(tidyverse)
library(here)
```


```{r}
class(clean_cut$status)
clean_cut$status <- as.factor(clean_cut$status)
levels(clean_cut$status)
# Set students on academic probation as the reference group
clean_cut$status <- relevel(clean_cut$status, "On Academic Probation")
clean_cut2$status <- as.factor(clean_cut2$status)
clean_cut2$status <- relevel(clean_cut2$status, "On Academic Probation")
clean_cut3$status <- as.factor(clean_cut3$status)
clean_cut3$status <- relevel(clean_cut3$status, "On Academic Probation")
```

```{r}
?coef_rename

gpa_model <- lm(GPA_year2 ~ status + dist_from_cut + gender + highHS + first_language, data = clean_cut)
test_gpa_model <- gpa_model
class(clean_cut$first_language)
test_gpa_model$coefficients
```

```{r}
stargazer(test_gpa_model)
```

```{r}
# Refer the following to create model summary table https://vincentarelbundock.github.io/modelsummary/articles/modelsummary.html
modelsummary(test_gpa_model,
             stars =TRUE,
             coef_rename = c("(Intercept)" = "Constant", "statusIn Good Standing" = "In Good Standing", "dist_from_cut" = "f(Cutoff Distance)", "genderMale" = "Gender Male", "highHS" = "Highschool Above Average", "first_languageOther" = "First Language Not English "))
```

```{r}
modelsummary(gpa_model,
             stars = TRUE,
             coef_rename = )
```

```{r}
gpa_model <- lm(GPA_year2 ~ status + dist_from_cut + gender + highHS + first_language, data = clean_cut)
summary(gpa_model)
```
```{r}
plot(gpa_model)
```
```{r}
cut_data_lin <- clean_for_summary %>% 
  filter(dist_from_cut >= -0.6, dist_from_cut <= 0.6)

#Filter invalid data caused by university administrative error in data reporting

clean_cut2 <- cut_data_lin %>% 
  filter((dist_from_cut < 0 & probation_year1 ==1)| (dist_from_cut >=0 & probation_year1 ==0) )

clean_cut2 <- clean_cut2 %>% 
  mutate( status = case_when(probation_year1 == 0 ~ "In Good Standing",
                             probation_year1 == 1 ~ "On Academic Probation"))

cut_data3 <- clean_for_summary %>% 
  filter(dist_from_cut >= -0.3, dist_from_cut <= 0.3)
clean_cut3 <- cut_data3 %>%
  filter((dist_from_cut < 0 & probation_year1 ==1)| (dist_from_cut >=0 & probation_year1 ==0) )
clean_cut3 <- clean_cut3 %>% 
    mutate( status = case_when(probation_year1 == 0 ~ "In Good Standing",
                             probation_year1 == 1 ~ "On Academic Probation"))

```

```{r}
#test_dropout_model2$coefficients
#test_dropout_model <- dropout_model
modelsummary(list("Bandwidth of 0.2 GPA" = test_dropout_model, "Bandwidth of 0.1 GPA" = test_dropout_model3,"Bandwidth of 0.6 GPA" =  test_dropout_model2),
             stars =TRUE,
             coef_map = c("(Intercept)" = "Constant", "statusIn Good Standing" = "In Good Standing", "dist_from_cut" = "f(Cutoff Distance)", "genderMale" = "Gender Male", "highHS" = "Highschool Above Average", "first_languageOther" = "First Language Not English ")
             ,exponentiate = TRUE
             ) %>% 
  add_footnote("test note", notation = "number")
```
```{r}
test_dropout_model2 <- glm(left_school ~ status + dist_from_cut + gender + highHS + first_language ,family = "binomial", data = clean_cut2)
```

```{r}
test_dropout_model3 <- glm(left_school ~ status + dist_from_cut + gender + highHS + first_language ,family = "binomial", data = clean_cut3)
```

```{r}
dropout_model <- glm(left_school ~ status + dist_from_cut + gender + highHS + first_language ,family = "binomial", data = clean_cut)
summary(dropout_model)
```

```{r}
fixed_dum1 <- glm(gradin4 ~ status + dist_from_cut,family = "binomial", data = clean_cut)
summary(fixed_dum1)
```

```{r}

grad_model <- glm(gradin4 ~ status + dist_from_cut + gender + highHS + first_language,family = "binomial", data = clean_cut)
summary(grad_model)
```

```{r}
?modelsummary
```


```{r}
## modelsummary
library(modelsummary)
modelsummary(gpa_model)
```

```{r}
rdplot(y = clean_for_summary$left_school, x = clean_for_summary$dist_from_cut, c = 0)
a1 <- rdrobust( y = clean_cut$left_school, x = clean_cut$dist_from_cut,c=0)
a2 <- rdrobust( y = clean_for_summary$left_school, x = clean_for_summary$dist_from_cut, c=0)
IKbandwidth( clean_for_summary$left_school, clean_for_summary$dist_from_cut, cutpoint=0)
IKbandwidth( clean_cut$left_school, clean_cut$dist_from_cut, cutpoint=0)
IKbandwidth(clean_for_summary$dist_from_cut,clean_for_summary$year2_dist_from_cut, cutpoint = 0, verbose = TRUE)
summary(a1)
summary(a2)
```
```{r}
rdplot(y = clean_cut$left_school, x = clean_cut$dist_from_cut, c = 0)
```

